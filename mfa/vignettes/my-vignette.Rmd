---
title: "Vignette Title"
author: "Yanli Fan, Jonathan Ackerman, Dario Cantore, Josiah Davis"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{mfa Vignette}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---
The mfa package can be used to perform Multiple Factor Analysis (MFA, also called multiple factorial analysis) on a given dataset or matrix. The centerpiece of the package is the mfa() function, which performs multiple factor analysis on the given data. 
Multiple factor analysis consists of 2 steps: In step one, the dataset is split up into several smaller sets, on each of which a principal component analysis is done. These tables are then normalized, each by its first singular value. In the second step the smaller datatables are concatenated to one big table that is again analyzed using principal component analysis. Through this analysis we obtain amongst others factor scores and variable loadings. (Mention paper?)

#mfa Function
The mfa function takes data, sets, ncomps, center and scale as parameters. It returns an object of class mfa.

The data parameter must either be a data.frame or matrix and contains all the data which will be analyzed through the multiple factor analysis.  
Sets is a list, where each element of the list indicates either the column names or numbers out of which one smaller datatable will be formed. If for example column 1 to 3 corresponds to the observation of one expert, the first element of sets will be 1:3. 
ncomps is the number of factors / components that will be extracted. If left to default all factors will be extracted.
Center is by default True and indicates whether centering in Step 1 (as outlined above) will be done. By default, each column is scaled so that the sum of its elements is zero.
Scale is by default True and indicates whether scaling in Step 1 (as outlined above) will  be done. By default, each column is scaled so that the sum of its squared elements is 1.
For further information concerning centering and scaling refer to the help of the base scale function ?scale. Please note the different meanings of scale = TRUE between base package and mfa function. Whereas in the standard R function scale = TRUE means the sum of the squared values of each column add up to nrow(data) - 1 (sample SD = 1), here they add up to 1.

The function returns an mfa object with attributes P, Q $\lambda$, F, Fk, where P and Q are the left repsectively right singular values resulting from the singular value decomposition as outlined in Step 2 above. Also returned is the vector of Eigenvalues $\lambda$, which are the singular values squared, $\Delta^2$. The common factor scores F, as well as the partial factor scores Fk are also returned. For details on their computation see WIREs Comput Stat 2013. doi: 10.1002/wics.1246 pp 8 (how to cite the paper?).

#Data Wine
The wine data is described in https://www.utdallas.edu/~herve/abdi-WiresCS-mfa-2013.pdf and can for example be found under https://github.com/ucb-stat243/stat243-fall-2016/tree/master/problem-sets/ﬁnal-project and will be used throughout the Vignette to provide examples.



```{r}
data2 <- read.csv("https://github.com/ucb-stat243/stat243-fall-2016/tree/master/problem-sets/ﬁnal-project/wines.csv")
SETS <- list(c(1:6),c(7:12), c(13:18),c(19:23),c(24:29),c(30:34),c(35:38),c(39:44),c(45:49),c(50:53))

mfa1 <- mfa(data = data, sets = SETS)

mfa1

```




#Generic Methods

#summary_eigenvalues.mfa Function
The summary function takes an mfa object as an input and returns a summary of its eigenvalues. This summary consists of the singular values, the eigenvalues, the cumulative sum of the eigenvalues, the /% of inertia explained, and the cumulative /% of inertia explained. 
```{r}
summary_eigenvalues(mfa1)
```


#plot.mfa Function
The plot function for mfa objects automatically plots the Compromise, Partial Factor Scores and Variable Loadings, using the plot_compromise, plot_partial_factor and plot_variable_loadings functions. It can take a color argument as input, which should be a list of vectors. Each element of the vector denotes observations (e.g. rows) of the data table which will then be displayed in the same color.

```{r}
plot(mfa1)
```


#plot_compromise Function
The plot_compromise Function for mfa objects plots the factor scores (factor scores and compromise are used interchangeably here) of the object.

#plot_partial_factor
The plot_partial_factor Function for mfa objects plots the partial factor scores for each table. This means that there will be k, the number of smaller datatables, or the length of the sets list given as input for the mfa function, plots. The user can specify which of the k plots should be displayed by setting the sets argument to a vector in the function call. By default all k plots are displayed.

#plot_variable_loadings
```{r}
plot(mfa1)

```




#Related Methods and Functions

#Contributions of an Observation to a Dimension
The ctr_o_d function also operates on an mfa object, it returns the contribution of an observation o on a dimension d. It takes as an input an
#finish this

$ctr_{i,l} = \frac{m_i * f_{i,l}^2}{\lambda_l^2}$, where $\lambda_l$ is the eigenvalue of dimension $l$, $m_i$ is the mass of the $i$-th dimension and $f_{i,l}$ is the factor score for the $i$-th observation for the $l$-th dimension.

#Contribution of a Variable to a Dimension
The ctr_j_l function operates on an mfa object, it returns the contribution of a variable j on a dimension l.

$ctr_{j,l} = a_j * q_{j,l}$ where $a_j$ is the $\alpha$ weight of the first variable (the inverse of the first singular value of the table from Step 1 of the mfa function), and $q_{j,l}$ is the loading of the $j$th variable for the $l$th dimension.


#Contribution of a Table to a Dimension
The ctr_k_l function operates on an mfa Object, it returns the contribution of a Table $k$ on a Dimension $l$.

$ctr_k_l = \sum_i^{J_k} ctr_j_l$ where $ctr_j_l$ is the contribution of a variable $j$ to a dimension $l$ and the sum goes over all variable in Table $k$. The contributions of a table $k$ to a dimension $l$ is therefore just the sum of the contributions of the variables comprising the table to the dimension $l$.

#Escoufier's RV Coefficient
#RV Function
The RV function analyzes the structure between two tables. It can be seen as the multivariate generalization of the squared Pearson Correlation Coefficient.
Given two tables as an input it returns the scalar RV.
RV = $\frac{trace(table1 \ table1^T) * trace(table2 \ table2^T)}{\sqrt(trace(table1 \ table1^T) * (table1 \ table1^T) * trace((table2 \ table2^T) * (table2 \ table2^T)))}$ where the Root is taken with respect to the entire denominator and $*$ as well as " " denote the normal Matrix Multiplication.

```{r}
RV(data2[,SETS[[1]]], data2[,SETS[[2]]])
```


#RV_Table Function
The RV Table function returns a matrix of RV Coefficients. 
The RV Table function takes as input one big dataset and a list which consists of vectors. These vectors denote the column indizes out of which tables will be created, between these tables the RV coefficients will be calculated. The pairwise RV Coefficient calculation is the same as for the RV function. The output is a matrix M, where $M_i_j$ is the RV coefficient between Table $i$ and Table $j$. Table $i$ is created by taking the $i$-th element of the set vector and extracting the corresponding columns out of the dataset / matrix given.

```{r}
RV_table(data2, SETS)
```








Vignettes are long form documentation commonly included in packages. Because they are part of the distribution of the package, they need to be as compact as possible. The `html_vignette` output type provides a custom style sheet (and tweaks some options) to ensure that the resulting html is as small as possible. The `html_vignette` format:

- Never uses retina figures
- Has a smaller default figure size
- Uses a custom CSS stylesheet instead of the default Twitter Bootstrap style

## Vignette Info

Note the various macros within the `vignette` section of the metadata block above. These are required in order to instruct R how to build the vignette. Note that you should change the `title` field and the `\VignetteIndexEntry` to match the title of your vignette.

## Styles

The `html_vignette` template includes a basic CSS theme. To override this theme you can specify your own CSS in the document metadata as follows:

    output: 
      rmarkdown::html_vignette:
        css: mystyles.css

## Figures

The figure sizes have been customised so that you can easily put two images side-by-side. 

```{r, fig.show='hold'}
plot(1:10)
plot(10:1)
```

You can enable figure captions by `fig_caption: yes` in YAML:

    output:
      rmarkdown::html_vignette:
        fig_caption: yes

Then you can use the chunk option `fig.cap = "Your figure caption."` in **knitr**.

## More Examples

You can write math expressions, e.g. $Y = X\beta + \epsilon$, footnotes^[A footnote here.], and tables, e.g. using `knitr::kable()`.

```{r, echo=FALSE, results='asis'}
knitr::kable(head(mtcars, 10))
```

Also a quote using `>`:

> "He who gives up [code] safety for [code] speed deserves neither."
([via](https://twitter.com/hadleywickham/status/504368538874703872))
